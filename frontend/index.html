<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nemesis V1</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="themes.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
</head>
<body>
    <div id="splash-screen" class="d-none">
        <video id="splash-video" src="animaciones/animacion_menesis.mp4" autoplay muted playsinline></video>
    </div>

    <div id="login-container" class="container-fluid vh-100 d-flex justify-content-center align-items-center">
        <div class="card p-4" style="width: 100%; max-width: 400px;">
            <div class="card-body">
                <h3 class="card-title text-center mb-4">NEMESIS</h3>
                <form id="auth-form">
                    <div class="mb-3">
                        <label for="correo_electronico" class="form-label">Correo Electrónico</label>
                        <input type="email" class="form-control" id="correo_electronico" required>
                    </div>
                    <div class="mb-3">
                        <label for="contrasena" class="form-label">Contraseña</label>
                        <input type="password" class="form-control" id="contrasena" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100" id="login-btn">Iniciar Sesión</button>
                </form>
            </div>
        </div>
    </div>

    <div id="app-container" class="d-none">
        <div class="sidebar">
            <h3 class="text-center mb-4">NEMESIS</h3>
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a id="link-analyst" class="nav-link dashboard-link" data-target="analyst-dashboard" href="#">
                        <i class="bi bi-graph-up me-2"></i>
                        <span id="text-analyst">Dashboard Analista</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a id="link-auditor" class="nav-link dashboard-link" data-target="auditor-dashboard" href="#">
                        <i class="bi bi-file-earmark-bar-graph me-2"></i>
                        <span id="text-auditor">Dashboard Auditor</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a id="link-admin" class="nav-link dashboard-link" data-target="admin-dashboard" href="#">
                        <i class="bi bi-person-fill-gear me-2"></i>
                        <span id="text-admin">Dashboard Administrador</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-target="logout"><i class="bi bi-box-arrow-right me-2"></i> Cerrar Sesión</a>
                </li>
                <!-- Selector de Temas -->
                <li class="nav-item dropdown mt-3 px-2">
                    <a class="nav-link dropdown-toggle" href="#" id="theme-switcher-btn" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-palette-fill me-2"></i> Cambiar Tema
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="theme-switcher-btn" id="theme-menu">
                        <li><h6 class="dropdown-header">Temas Oscuros</h6></li>
                        <li><a class="dropdown-item" href="#" data-theme="dark-default">Oscuro (Default)</a></li>
                        <li><a class="dropdown-item" href="#" data-theme="dark-blue">Azul Oscuro</a></li>
                        <li><a class="dropdown-item" href="#" data-theme="dark-green">Verde Oscuro</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><h6 class="dropdown-header">Temas Claros</h6></li>
                        <li><a class="dropdown-item" href="#" data-theme="light-default">Claro (Default)</a></li>
                        <li><a class="dropdown-item" href="#" data-theme="light-warm">Cálido</a></li>
                        <li><a class="dropdown-item" href="#" data-theme="light-cool">Frío</a></li>
                    </ul>
                </li>
            </ul>
        </div>
        <button class="sidebar-toggle-btn" type="button">
            <i class="bi bi-list"></i>
        </button>
        <div class="main-content">
	        <div id="analyst-dashboard" class="dashboard-section d-none">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-4">
                <h1 id="analyst-title" class="h2 fw-bold"></h1>
            </div>
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Filtros de Auditorías</h5>
                            <form class="row g-3">
                                <div class="col-md-3">
                                    <label for="filterStatus" class="form-label">Estado</label>
                                    <select id="filterStatus" class="form-select">
                                        <option selected>Todos</option>
                                        <option>En Progreso</option>
                                        <option>Finalizada</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label for="filterAuditor" class="form-label">Auditor</label>
                                    <select id="filterAuditor" class="form-select">
                                        <option selected>Todos</option>
                                        <option>Auditor 1</option>
                                        <option>Auditor 2</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label for="filterStartDate" class="form-label">Fecha de Inicio</label>
                                    <input type="date" class="form-control" id="filterStartDate">
                                </div>
                                <div class="col-md-3">
                                    <label for="filterEndDate" class="form-label">Fecha de Fin</label>
                                    <input type="date" class="form-control" id="filterEndDate">
                                </div>
                                <div class="col-md-3 d-flex align-items-end">
                                    <button type="submit" class="btn btn-primary w-100"><i class="bi bi-funnel"></i> Filtrar</button>
                                </div>
                                <div class="col-md-3 d-flex align-items-end">
                                    <div class="btn-group w-100">
                                        <button type="button" class="btn btn-secondary dropdown-toggle w-100" data-bs-toggle="dropdown" aria-expanded="false">
                                            <i class="bi bi-download"></i> Descargar Informe
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item" href="#" id="download-general-excel">General (Excel)</a></li>
                                            <li><a class="dropdown-item" href="#" id="download-general-pdf">General (PDF)</a></li>
                                            <li><hr class="dropdown-divider"></li>
                                            <li><a class="dropdown-item" href="#" id="download-novelties-excel">Detalle Novedades (Excel)</a></li>
                                            <li><a class="dropdown-item" href="#" id="download-novelties-pdf">Detalle Novedades (PDF)</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body chart-container">
                            <h5 class="card-title">Cumplimiento por Auditoría</h5>
                            <canvas id="complianceChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body chart-container">
                            <h5 class="card-title">Novedades Registradas</h5>
                            <canvas id="noveltiesChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="card-title">Auditorías Recientes</h5>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover table-dark">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Ubicación</th>
                                            <th>Auditor</th>
                                            <th>Fecha</th>
                                            <th>Estado</th>
                                            <th>Productos</th>
                                            <th>% Cumplimiento</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="analyst-audits-table-body">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

	        <div id="auditor-dashboard" class="dashboard-section d-none">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-4">
                <h1 id="auditor-title" class="h2 fw-bold">Dashboard del Auditor</h1>
            </div>
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Porcentaje de Auditoría</h5>
                                <div id="compliance-percentage" class="progress-circle mx-auto">N/A</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title">Cargar Archivos de Auditoría</h5>
                            
                            <form id="uploadForm" class="mb-3">
                                <div class="input-group">
                                    <input type="file" class="form-control" id="audit-file-input" accept=".xlsx,.xls" multiple>
                                    <button class="btn btn-primary" type="submit"><i class="bi bi-upload"></i> Subir Archivos</button>
                                </div>
                                <small class="form-text text-muted"><b>Selecciona tus archivos</b> Cada archivo debe ser una orden de traslado.</small>
                                <div id="selected-files" class="mt-2"></div>
                            </form>
                                <hr class="border-secondary">
                                <h5 class="card-title">Escaneo de Productos</h5>
                                <div class="input-group">
                                    <span class="input-group-text" id="scan-icon"><i class="bi bi-qr-code-scan"></i></span>
                                    <input type="text" class="form-control" placeholder="Escanea el SKU del producto..." id="scan-input">
                                    <!-- Botón para escanear con cámara -->
                                    <button class="btn btn-outline-secondary" type="button" id="start-camera-scan-btn" title="Escanear con cámara">
                                        <i class="bi bi-camera-video"></i>
                                    </button>
                                </div>
                        
                                
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h5 class="card-title">Mis Auditorías</h5>
                                    <div class="btn-group" role="group">
                                        <button id="show-finished-audits-btn" class="btn btn-outline-secondary" type="button">
                                            <i class="bi bi-archive"></i> Ver auditorías finalizadas
                                        </button>
                                        <button id="hide-finished-audits-btn" class="btn btn-outline-secondary d-none" type="button">
                                            <i class="bi bi-arrow-left"></i> Volver a auditorías activas
                                        </button>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-hover table-dark">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Orden de traslado</th>
                                                <th>Fecha</th>
                                                <th>Estado</th>
                                                <th>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody id="auditor-audits-table-body">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Productos de la Auditoría</h5>
                                <div class="table-responsive">
                                    <table class="table table-hover table-dark">
                                        <thead>
                                            <tr>
                                                <th>SKU</th>
                                                <th>Orden de Traslado</th>
                                                <th>Nombre</th>
                                                <th>Cantidad Documento</th>
                                                <th>Cantidad Física</th>
                                                <th>Novedad</th>
                                                <th>Observaciones</th>
                                                <th>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody id="auditor-products-table-body">
                                        </tbody>
                                    </table>
                                </div>
                                <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-3">
                                    <button class="btn btn-success d-none" id="save-all-btn"><i class="bi bi-save"></i> Guardar Auditoría</button>
                                    <button class="btn btn-info text-white d-none" id="finish-audit-btn"><i class="bi bi-check-circle"></i> Finalizar Auditoría</button>
                                    <button id="collaborative-audit-btn" class="btn btn-outline-primary d-none" type="button">
                                        <i class="bi bi-people"></i> Auditoría Colaborativa
                                    </button>
                                </div>
                                <!-- Panel de Auditoría Colaborativa (reemplaza el modal) -->
                                <div id="collaborative-panel" class="d-none mt-4" tabindex="-1">
                                    <h5 class="text-white">Asignar Colaboradores</h5>
                                    <form id="collaborative-audit-form">
                                        <div class="mb-3">
                                            <label for="collaborative-auditors-select" class="form-label">Selecciona uno o más auditores:</label>
                                            <select id="collaborative-auditors-select" class="form-select" multiple required>
                                                <!-- Opciones generadas dinámicamente -->
                                            </select>
                                            <div class="form-text">Puedes seleccionar varios auditores manteniendo presionada la tecla Ctrl (o Cmd en Mac).</div>
                                        </div>
                                        <div class="d-flex justify-content-end">
                                            <button type="button" class="btn btn-secondary me-2" id="cancel-collaborative-audit">Cancelar</button>
                                            <button type="submit" class="btn btn-primary" id="confirm-collaborative-audit">Asignar</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        </div>

	        <div id="admin-dashboard" class="dashboard-section d-none">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-4">
                <h1 id="admin-title" class="h2 fw-bold">Dashboard del Administrador</h1>
            </div>
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="card-title">Usuarios del Sistema</h5>
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal"><i class="bi bi-plus-lg"></i> Agregar Usuario</button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover table-dark">
                                    <thead>
                                        <tr>
                                            <th>Nombre</th>
                                            <th>Correo Electrónico</th>
                                            <th>Rol</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="admin-users-table-body">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Auditorías del Día</h5>
                            <div class="table-responsive">
                                <table class="table table-hover table-dark">
                                    <thead>
                                        <tr>
                                            <th>Orden de Traslado</th>
                                            <th>Auditor</th>
                                            <th>Estado</th>
                                            <th>% Cumplimiento</th>
                                        </tr>
                                    </thead>
                                    <tbody id="admin-audits-table-body">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    
        <!-- Contenedor para el Escáner de Cámara -->
        <div id="scanner-container" class="d-none">
            <div id="reader"></div>
            <button id="close-scanner-btn" class="btn btn-danger mt-2">Cerrar Cámara</button>
        </div>

        <!-- Modal para Agregar Usuario (Admin) -->
        <div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addUserModalLabel">Agregar Nuevo Usuario</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="add-user-form">
                            <div class="mb-3">
                                <label for="new-user-name" class="form-label">Nombre</label>
                                <input type="text" class="form-control" id="new-user-name" required>
                            </div>
                            <div class="mb-3">
                                <label for="new-user-email" class="form-label">Correo Electrónico</label>
                                <input type="email" class="form-control" id="new-user-email" required>
                            </div>
                            <div class="mb-3">
                                <label for="new-user-password" class="form-label">Contraseña</label>
                                <input type="password" class="form-control" id="new-user-password" required>
                            </div>
                            <div class="mb-3">
                                <label for="new-user-role" class="form-label">Rol</label>
                                <select class="form-select" id="new-user-role" required>
                                    <option value="auditor">Auditor</option>
                                    <option value="analista">Analista</option>
                                    <option value="administrador">Administrador</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" id="confirm-add-user">Agregar Usuario</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Modal para ver detalles de auditoría (Analista) -->
        <div class="modal fade" id="viewAuditModal" tabindex="-1" aria-labelledby="viewAuditModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="viewAuditModalLabel">Detalles de la Auditoría</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div id="audit-details-content" class="mb-4"></div>
                        <h5 class="card-title">Productos de la Auditoría</h5>
                        <div class="table-responsive">
                            <table class="table table-hover table-dark">
                                <thead>
                                    <tr>
                                        <th>SKU</th>
                                        <th>Orden de Traslado</th>
                                        <th>Nombre</th>
                                        <th>Cantidad Documento</th>
                                        <th>Cantidad Física</th>
                                        <th>Novedad</th>
                                        <th>Observaciones</th>
                                    </tr>
                                </thead>
                                <tbody id="analyst-audit-products-table-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- Cierre de app-container -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <!-- Librerías para exportar informes -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <!-- Fin de librerías para informes -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="js/main.js" type="module"></script>
</body>
</html>